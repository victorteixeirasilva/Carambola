CREATE TABLE TB_CATALOGO (
	CAT_IDCAT NUMERIC(10) NOT NULL,
	CAT_NOMECAT VARCHAR(60) NOT NULL,
	CAT_DESCCAT VARCHAR(100) NOT NULL
);

CREATE TABLE TB_USUARIOS (
	USU_IDUSU NUMERIC(10) NOT NULL,
	USU_IDLOG NUMERIC(10),
	USU_NOME VARCHAR(60) NOT NULL, // 
	USU_DATANASC DATE NOT NULL, //
	USU_CPF NUMERIC(11) UNIQUE NOT NULL, //
	USU_TEL NUMERIC(11) UNIQUE NOT NULL, 
	USU_EMAIL VARCHAR(60) UNIQUE NOT NULL,
	USU_SENHA VARCHAR(60) NOT NULL,
	USU_CEP NUMERIC(8) NOT NULL, //
	USU_NUMRESI NUMERIC(4) NOT NULL //
);

CREATE TABLE TB_LOGIN (
	LOG_IDLOG NUMERIC(10) NOT NULL,
	LOG_IDUSU NUMERIC(10),
	LOG_EMAIL VARCHAR(60) NOT NULL,
	LOG_SENHA VARCHAR(60) NOT NULL
);

CREATE TABLE TB_COMANDA (
	COM_IDCOM NUMERIC(10) NOT NULL,
	COM_IDUSU NUMERIC(10),
	COM_DATA DATE
);

CREATE TABLE TB_ITENSCOMANDA (
	ITE_IDCOM NUMERIC(10) NOT NULL,
	ITE_CODPROD NUMERIC(10) NOT NULL,
	ITE_QTDITENS NUMERIC(5) NOT NULL
);

CREATE TABLE TB_PRODUTOS (
	PRO_IDPROD NUMERIC(10) NOT NULL,
	PRO_IDCATE NUMERIC(10),
	PRO_DESC VARCHAR(50) NOT NULL,
	PRO_VALOR NUMERIC(10,2) NOT NULL
);

CREATE TABLE TB_CATEGORIAS (
CATE_IDCATE NUMERIC(10) NOT NULL,
CATE_IDCAT NUMERIC(10),
CATE_DESCCATE VARCHAR(60) NOT NULL
);

CREATE SEQUENCE SQ_USU_IDUSU START WITH 1000 INCREMENT BY 1 NO CYCLE;
CREATE SEQUENCE SQ_LOG_IDLOG START WITH 1 INCREMENT BY 1 NO CYCLE;
CREATE SEQUENCE SQ_COM_IDCOM START WITH 100 INCREMENT BY 1 NO CYCLE;
CREATE SEQUENCE SQ_PRO_IDPROD START WITH 500 INCREMENT BY 1 NO CYCLE;
CREATE SEQUENCE SQ_CAT_IDCAT START WITH 1000 INCREMENT BY 1 NO CYCLE;
CREATE SEQUENCE SQ_CATE_IDCATE START WITH 10 INCREMENT BY 1 NO CYCLE;

ALTER TABLE TB_USUARIOS ADD CONSTRAINT TB_USUARIOS_USU_IDUSU_PK PRIMARY KEY(USU_IDUSU);
ALTER TABLE TB_LOGIN ADD CONSTRAINT TB_LOGIN_LOG_IDLOG_PK PRIMARY KEY(LOG_IDLOG);
ALTER TABLE TB_COMANDA ADD CONSTRAINT TB_COMANDA_COM_IDCOM_PK PRIMARY KEY(COM_IDCOM);
ALTER TABLE TB_PRODUTOS ADD CONSTRAINT TB_PRODUTOS_PRO_IDPROD_PK PRIMARY KEY(PRO_IDPROD);
ALTER TABLE TB_CATALOGO ADD CONSTRAINT TB_CATALOGO_CAT_IDCAT_PK PRIMARY KEY(CAT_IDCAT);
ALTER TABLE TB_CATEGORIAS ADD CONSTRAINT TB_CATEGORIAS_CATE_IDCATE_PK PRIMARY KEY(CATE_IDCATE);
ALTER TABLE TB_USUARIOS ADD CONSTRAINT TB_USUARIOS_USU_IDLOG_FK FOREIGN KEY(USU_IDLOG) REFERENCES TB_LOGIN(LOG_IDLOG);
ALTER TABLE TB_LOGIN ADD CONSTRAINT TB_LOGIN_LOG_IDUSU_FK FOREIGN KEY(LOG_IDUSU) REFERENCES TB_USUARIOS(USU_IDUSU);
ALTER TABLE TB_COMANDA ADD CONSTRAINT TB_COMANDA_COM_IDUSU_FK FOREIGN KEY(COM_IDUSU) REFERENCES TB_USUARIOS(USU_IDUSU);
ALTER TABLE TB_ITENSCOMANDA ADD CONSTRAINT TB_ITENSCOMANDA_ITE_IDCOM_FK FOREIGN KEY(ITE_IDCOM) REFERENCES TB_COMANDA(COM_IDCOM);
ALTER TABLE TB_ITENSCOMANDA ADD CONSTRAINT TB_ITENSCOMANDA_ITE_CODPROD_FK FOREIGN KEY(ITE_CODPROD) REFERENCES TB_PRODUTOS(PRO_IDPROD);
ALTER TABLE TB_PRODUTOS ADD CONSTRAINT TB_PRODUTOS_PRO_IDCATE_FK FOREIGN KEY(PRO_IDCATE) REFERENCES TB_CATEGORIAS(CATE_IDCATE);
ALTER TABLE TB_CATEGORIAS ADD CONSTRAINT TB_CATEGORIAS_CATE_IDCAT_FK FOREIGN KEY(CATE_IDCAT) REFERENCES TB_CATALOGO(CAT_IDCAT);

ALTER TABLE TB_PRODUTOS ADD COLUMN PRO_TEMESTOQUE BOOLEAN;

ALTER TABLE TB_CATALOGO DROP COLUMN CAT_DESCCAT;

ALTER TABLE TB_USUARIOS DROP COLUMN USU_CEP;  

ALTER TABLE TB_USUARIOS DROP COLUMN USU_NUMRESI;  

ALTER TABLE TB_USUARIOS DROP COLUMN USU_CPF;  

ALTER TABLE TB_USUARIOS DROP COLUMN USU_DATANASC;  

ALTER TABLE TB_USUARIOS DROP COLUMN USU_NOME;  

CREATE TABLE TB_USUARIOS_CLIENTE (
    USUCLI_IDUSUCLI NUMERIC(10) NOT NULL,
    USUCLI_IDUSU NUMERIC(10),
    USUCLI_NOME VARCHAR(60) NOT NULL,
    USU_DATANASC DATE NOT NULL,
    USU_CPF NUMERIC(11) UNIQUE NOT NULL,
    PRIMARY KEY (USUCLI_IDUSUCLI),
    FOREIGN KEY (USUCLI_IDUSU) REFERENCES TB_USUARIOS (USU_IDUSU)
);

ALTER TABLE TB_USUARIOS ADD COLUMN USU_IDUSUCLI NUMERIC(10);

ALTER TABLE TB_USUARIOS ADD CONSTRAINT TB_USUARIOS_USU_IDUSUCLI_FK FOREIGN KEY(USU_IDUSUCLI) REFERENCES TB_USUARIOS_CLIENTE(USUCLI_IDUSUCLI);

CREATE TABLE TB_USUARIOS_ESTABELECIMENTO (
    USUEST_IDUSUEST NUMERIC(10) NOT NULL,
    USUEST_IDUSU NUMERIC(10),
    USUEST_NOME VARCHAR(60) NOT NULL,
    USU_CNPJ NUMERIC(14) UNIQUE NOT NULL,
    PRIMARY KEY (USUEST_IDUSUEST),
    FOREIGN KEY (USUEST_IDUSU) REFERENCES TB_USUARIOS (USU_IDUSU)
);

ALTER TABLE TB_USUARIOS ADD COLUMN USU_IDUSUEST NUMERIC(10);

ALTER TABLE TB_USUARIOS ADD CONSTRAINT TB_USUARIOS_USU_IDUSUEST_FK FOREIGN KEY(USU_IDUSUEST) REFERENCES TB_USUARIOS_ESTABELECIMENTO(USUEST_IDUSUEST);

ALTER TABLE TB_USUARIOS ADD COLUMN USU_IDUSUFUN NUMERIC(10);

ALTER TABLE TB_USUARIOS_ESTABELECIMENTO ADD COLUMN USUEST_IDUSUFUN NUMERIC(10);

CREATE TABLE TB_USUARIOS_FUNCIONARIOS (
    USUFUN_IDUSUFUN NUMERIC(10) NOT NULL,
    USUFUN_IDUSUEST NUMERIC(10) NOT NULL,
    USUFUN_IDUSU NUMERIC(10),
    USUFUN_NOME VARCHAR(60) NOT NULL,
    USU_CPF NUMERIC(11) UNIQUE NOT NULL
);

ALTER TABLE TB_USUARIOS_FUNCIONARIOS ADD CONSTRAINT TB_USUARIOS_FUNCIONARIOS_USUFUN_IDUSUFUN_PK PRIMARY KEY(USUFUN_IDUSUFUN);

ALTER TABLE TB_USUARIOS_FUNCIONARIOS ADD CONSTRAINT TB_USUARIOS_FUNCIONARIOS_USUFUN_IDUSU_FK FOREIGN KEY(USUFUN_IDUSU) REFERENCES TB_USUARIOS (USU_IDUSU);

ALTER TABLE TB_USUARIOS_FUNCIONARIOS ADD CONSTRAINT TB_USUARIOS_FUNCIONARIOS_USUFUN_IDUSUEST_FK FOREIGN KEY(USUFUN_IDUSUEST) REFERENCES TB_USUARIOS_ESTABELECIMENTO (USUEST_IDUSUEST);

ALTER TABLE TB_USUARIOS ADD CONSTRAINT TB_USUARIOS_USU_IDUSUFUN_FK FOREIGN KEY(USU_IDUSUFUN) REFERENCES TB_USUARIOS_FUNCIONARIOS(USUFUN_IDUSUFUN);

CREATE TABLE TB_ENDERECOS (
    END_IDEND NUMERIC(10) NOT NULL,
    END_IDUSU NUMERIC(10),
    END_RUA VARCHAR(200) NOT NULL,
    END_BAIRRO VARCHAR(60) NOT NULL,
    END_REFERENCIA VARCHAR(100),
    END_CEP NUMERIC(9) NOT NULL,
    END_NUMERO NUMERIC(10) NOT NULL,
    PRIMARY KEY (END_IDEND),
    FOREIGN KEY (END_IDUSU) REFERENCES TB_USUARIOS (USU_IDUSU)
);

ALTER TABLE TB_USUARIOS ADD COLUMN USU_IDEND NUMERIC(10);

ALTER TABLE TB_USUARIOS ADD CONSTRAINT TB_USUARIOS_USU_IDEND_FK FOREIGN KEY(USU_IDEND) REFERENCES TB_ENDERECOS(END_IDEND);

ALTER TABLE TB_CATALOGO ADD COLUMN CAT_IDUSUEST NUMERIC(10);

ALTER TABLE TB_USUARIOS_ESTABELECIMENTO ADD COLUMN USUEST_IDCAT NUMERIC(10);

ALTER TABLE TB_USUARIOS_ESTABELECIMENTO ADD CONSTRAINT TB_USUARIOS_ESTABELECIMENTO_USUEST_IDCAT_FK FOREIGN KEY(USUEST_IDCAT) REFERENCES TB_CATALOGO(CAT_IDCAT);

ALTER TABLE TB_CATALOGO ADD CONSTRAINT TB_CATALOGO_CAT_IDUSUEST_FK FOREIGN KEY(CAT_IDUSUEST) REFERENCES TB_USUARIOS_ESTABELECIMENTO(USUEST_IDUSUEST);

CREATE SEQUENCE SQ_END_IDEND START WITH 1000 INCREMENT BY 1 NO CYCLE;

ALTER TABLE TB_ENDERECOS ALTER COLUMN END_CEP VARCHAR(9);





//EXEMPLOS DE INSERT
INSERT INTO TB_USUARIOS(USU_IDUSU,USU_NOME,USU_DATANASC,USU_CPF,USU_TEL,USU_EMAIL,USU_SENHA,USU_CEP,USU_NUMRESI) VALUES (NEXT VALUE FOR SQ_USU_IDUSU,'Victor Teixeira Silva',DATE '2003-08-23',45275798948,11981709247,'victor@carambola.com','v1i2c3t4o5r6',04917140,374);

INSERT INTO TB_CATALOGO(CAT_IDCAT,CAT_NOMECAT,CAT_DESCCAT) VALUES (NEXT VALUE FOR SQ_CAT_IDCAT,'VARANDA DO PEP','BAR RESTAURANTE');

INSERT INTO TB_CATEGORIAS (CATE_IDCATE,CATE_IDCAT,CATE_DESCCATE) VALUES (NEXT VALUE FOR SQ_CATE_IDCATE,1,'BEBIDAS');

INSERT INTO TB_PRODUTOS (PRO_IDPROD,PRO_IDCATE,PRO_DESC,PRO_VALOR) VALUES (NEXT VALUE FOR SQ_PRO_IDPROD,10,'COCA COLA LATA',5);

INSERT INTO TB_COMANDA (COM_IDCOM,COM_IDUSU,COM_DATA) VALUES (NEXT VALUE FOR SQ_COM_IDCOM,1000,DATE '2022-10-16');

INSERT INTO TB_ITENSCOMANDA (ITE_IDCOM,ITE_CODPROD,ITE_QTDITENS) VALUES (100,500,2);

//SELECT PARA CONSULTA DE TODOS OS PRODUTOS DE MESMA CATEGORIA
SELECT (USUEST_IDUSU ) FROM TB_USUARIOS_ESTABELECIMENTO WHERE USUEST_IDUSU = 1000;

SELECT * FROM TB_PRODUTOS PRO JOIN TB_CATEGORIAS CATE ON PRO.PRO_IDCATE = CATE.CATE_IDCATE WHERE CATE.CATE_IDCATE = '1';

//SELECT PARA CONSULTAR TODAS AS CATEGORIAS DE UM DETERMINADO CATALOGO
SELECT * FROM TB_CATEGORIAS  CATE JOIN TB_CATALOGO  CAT ON CATE.CATE_IDCAT  = CAT.CAT_IDCAT WHERE CAT.CAT_IDCAT = '1';

DELETE FROM TB_CATEGORIAS WHERE CATE_IDCATE = '1';
 
//COMANDO PARA LIMPAR TODO BD
TRUNCATE ALL;
 
//COMANDO PARA RESETAR AS SEQUEBNCIAS  
ALTER SEQUENCE SQ_USU_IDUSU RESTART WITH 1000;
ALTER SEQUENCE SQ_LOG_IDLOG RESTART WITH 1;
ALTER SEQUENCE SQ_COM_IDCOM RESTART WITH 100;
ALTER SEQUENCE SQ_PRO_IDPROD RESTART WITH 500;
ALTER SEQUENCE SQ_CAT_IDCAT RESTART WITH 1000;
ALTER SEQUENCE SQ_CATE_IDCATE RESTART WITH 10;
ALTER SEQUENCE SQ_END_IDEND RESTART WITH 1000;




